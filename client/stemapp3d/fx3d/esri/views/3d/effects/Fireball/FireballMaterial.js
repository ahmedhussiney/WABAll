/**
 * Copyright @ 2016 Esri.
 * All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 */
define(["dojo/_base/declare","dojo/text!./FireballMaterial.xml","esri/views/3d/webgl-engine/lib/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils"],function(i,t,r,s,e){var a=i(null,{declaredClass:"esri.views.3d.effects.Fireball.FireballMaterial",constructor:function(i){this._gl=i.gl,this._vbLayout=i.vbLayout,this._shaderSnippets=i.shaderSnippets,this._program=null,this._srcAlpha=770,this._dstAlpha=1,i.local&&(this._srcAlpha=770,this._dstAlpha=771)},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null)},loadShaders:function(i){if(this._shaderSnippets){(null==this._shaderSnippets.fireballVS||null==this._shaderSnippets.fireballFS)&&this._shaderSnippets._parse(t);var e=new r(35633,this._shaderSnippets.fireballVS,this._gl),a=new r(35632,this._shaderSnippets.fireballFS,this._gl);this._program=new s([e,a],this._gl)}return this._initResources()},getProgram:function(){return this._program},_initResources:function(){return!0},bind:function(i){this._program.use(),this._program.uniform1f("vme",i.viewingMode),this._program.uniformMatrix4fv("pmt",i.proj),this._program.uniformMatrix4fv("vmt",i.view),this._program.uniform3fv("cpsn",i.camPos),this._program.uniform3fv("ldn",i.lightingData.direction),this._program.uniform4fv("lat",i.lightingData.ambient),this._program.uniform4fv("lde",i.lightingData.diffuse),this._program.uniform4fv("lsr",i.lightingData.specular),i.vfv.bind(0),this._program.uniform1i("vfv",0),this._program.uniform2fv("vfvs",i.vfvs),this._program.uniform2fv("wmmv",[i.minValue,i.maxValue]),i.avt.bind(1),this._program.uniform1i("avt",1),this._program.uniform2fv("avts",i.avts),this._gl.activeTexture(33986),this._gl.bindTexture(3553,i.cmt),this._program.uniform1i("cmt",2),this._gl.activeTexture(33987),this._gl.bindTexture(3553,i.cbte),this._program.uniform1i("cbte",3),this._program.uniform1f("ai",i.ai),this._program.uniform1f("brs",i.brs),this._program.uniform1f("tcy",i.tcy),this._program.uniform1f("fte",i.time),this._program.uniform1i("rpl",i.rpl),this._vbLayout.enableVertexAttribArrays(this._gl,this._program,!1),this._gl.depthMask(!1),this._gl.enable(2884),this._gl.enable(2929),this._gl.enable(3042),this._gl.blendFunc(this._srcAlpha,this._dstAlpha)},bindBoolean:function(i,t){this._program.uniform1i(i,t)},blend:function(i){0==i?this._gl.blendFunc(this._srcAlpha,this._dstAlpha):1==i&&this._gl.blendFunc(770,771)},release:function(){this._gl.activeTexture(33984),this._gl.depthMask(!0),this._gl.blendFunc(770,771),this._gl.disable(3042),this._gl.disable(2884),this._vbLayout.disableVertexAttribArrays(this._gl,this._program,!1),this._gl.useProgram(null)}});return a});