/**
 * Copyright @ 2016 Esri.
 * All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 */
define(["dojo/_base/declare","dojo/text!./PulseMaterial.xml","esri/views/3d/webgl-engine/lib/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils"],function(i,t,r,e,s){var a=i(null,{declaredClass:"esri.viewports.viewport3d.canvas3d.3dexp.effects.Pulse.PulseMaterial",constructor:function(i){this._gl=i.gl,this._vbLayout=i.vbLayout,this._shaderSnippets=i.shaderSnippets,this._program=null},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null)},loadShaders:function(){if(this._shaderSnippets){(void 0===this._shaderSnippets.pulseVS||void 0===this._shaderSnippets.pulseFS)&&this._shaderSnippets._parse(t);var i=new r(35633,this._shaderSnippets.pulseVS,this._gl),s=new r(35632,this._shaderSnippets.pulseFS,this._gl);this._program=new e([i,s],this._gl)}return this._initResources()},getProgram:function(){return this._program},_initResources:function(){return!0},bind:function(i){this._program.use(),this._program.uniform1f("vme",i.viewingMode),this._program.uniformMatrix4fv("pmt",i.proj),this._program.uniformMatrix4fv("vmt",i.view),this._program.uniform1i("drg",i.drg),this._program.uniform1f("wss",i.wss),this._program.uniform3fv("cps",i.camPos),this._program.uniform3fv("ldn",i.lightingData.direction),this._program.uniform4fv("lat",i.lightingData.ambient),this._program.uniform4fv("lde",i.lightingData.diffuse),this._program.uniform4fv("lsr",i.lightingData.specular),i.svfe.bind(0),this._program.uniform1i("svfe",0),i.evfe.bind(1),this._program.uniform1i("evfe",1),this._program.uniform2fv("vfvs",i.vfvs),this._program.uniform2fv("wmmv",[i.minValue,i.maxValue]),this._program.uniform2fv("irs",i.irs),this._program.uniform1f("ail",i.ail),this._program.uniform1f("tcy",i.tcy),this._gl.activeTexture(33986),this._gl.bindTexture(3553,i.cbte),this._program.uniform1i("cbte",2),this._program.uniform1f("fte",i.time),this._program.uniform1i("rpt",i.reachedRepeatLimit),this._program.uniform3fv("scr",i.scr),this._gl.enable(2929),this._gl.enable(2884),this._gl.cullFace(1028),this._gl.enable(3042),this._gl.blendFunc(770,771),519!==this._gl.web3DDefaultState.depthFunc&&this._gl.depthFunc(519),this._gl.depthMask(!1),this._vbLayout.enableVertexAttribArrays(this._gl,this._program,!1)},release:function(){this._gl.activeTexture(33984),this._gl.bindTexture(3553,null),this._gl.cullFace(1029),this._gl.disable(2884),this._gl.enable(3042),this._gl.depthMask(!0),519!==this._gl.web3DDefaultState.depthFunc&&this._gl.depthFunc(this._gl.web3DDefaultState.depthFunc),this._vbLayout.disableVertexAttribArrays(this._gl,this._program,!1),this._gl.useProgram(null)}});return a});