/**
 * Copyright @ 2016 Esri.
 * All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 */
define(["dojo/_base/declare","dojo/text!./JetTrailMaterial.xml","esri/views/3d/webgl-engine/lib/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils"],function(t,i,s,r,e){var a=t(null,{declaredClass:"esri.views.3d.effects.JetTrail.JetTrailMaterial",constructor:function(t){this._gl=t.gl,this._vbLayout=t.vbLayout,this._shaderSnippets=t.shaderSnippets,this._program=null,this._pulseProgram=null,this._srcAlpha=770,this._dstAlpha=771,t.local&&(this._srcAlpha=770,this._dstAlpha=771)},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null),this._pulseProgram&&(this._pulseProgram.dispose(),delete this._pulseProgram,this._pulseProgram=null)},loadShaders:function(t){if(this._shaderSnippets){(null==this._shaderSnippets.jetTrailVS||null==this._shaderSnippets.jetTrailFS)&&this._shaderSnippets._parse(i);var e=new s(35633,this._shaderSnippets.jetTrailVS,this._gl),a=new s(35632,this._shaderSnippets.jetTrailFS,this._gl);this._program=new r([e,a],this._gl),(null==this._shaderSnippets.jetTrailPulseVS||null==this._shaderSnippets.jetTrailPulseFS)&&this._shaderSnippets._parse(i),e=new s(35633,this._shaderSnippets.jetTrailPulseVS,this._gl),a=new s(35632,this._shaderSnippets.jetTrailPulseFS,this._gl),this._pulseProgram=new r([e,a],this._gl)}return this._initResources()},getProgram:function(){return this._program},_initResources:function(){return!0},bind:function(t){this._program.use(),this._program.uniform1f("vme",t.viewingMode),this._program.uniformMatrix4fv("pmt",t.proj),this._program.uniformMatrix4fv("vmt",t.view),this._program.uniform3fv("cpsn",t.camPos),this._program.uniform3fv("ldn",t.lightingData.direction),this._program.uniform4fv("lat",t.lightingData.ambient),this._program.uniform4fv("lde",t.lightingData.diffuse),this._program.uniform4fv("lsr",t.lightingData.specular),t.vfvt.bind(0),this._program.uniform1i("vfvt",0),this._program.uniform2fv("vfvts",t.vfvts),this._program.uniform2fv("wmmv",[t.minValue,t.maxValue]),t.avte.bind(1),this._program.uniform1i("avte",1),this._program.uniform2fv("avtes",t.avtes),this._gl.activeTexture(33986),this._gl.bindTexture(3553,t.cmte),this._program.uniform1i("cmte",2),this._gl.activeTexture(33987),this._gl.bindTexture(3553,t.cbte),this._program.uniform1i("cbte",3),this._program.uniform1f("ail",t.ail),this._program.uniform1f("brs",t.brs),this._program.uniform1f("tcy",t.tcy),this._program.uniform1f("fte",t.time),this._vbLayout.enableVertexAttribArrays(this._gl,this._program,!1),this._gl.depthMask(!1),this._gl.enable(2884),this._gl.enable(2929),this._gl.enable(3042),this._gl.blendFunc(this._srcAlpha,this._dstAlpha)},bindPulse:function(t){this._pulseProgram.use(),this._pulseProgram.uniform1f("vme",t.viewingMode),this._pulseProgram.uniformMatrix4fv("pmt",t.proj),this._pulseProgram.uniformMatrix4fv("vmt",t.view),this._pulseProgram.uniform3fv("cpsn",t.camPos),this._pulseProgram.uniform3fv("ldn",t.lightingData.direction),this._pulseProgram.uniform4fv("lat",t.lightingData.ambient),this._pulseProgram.uniform4fv("lde",t.lightingData.diffuse),this._pulseProgram.uniform4fv("lsr",t.lightingData.specular),t.vfvt.bind(0),this._pulseProgram.uniform1i("vfvt",0),this._pulseProgram.uniform2fv("vfvts",t.vfvts),this._pulseProgram.uniform2fv("wmmv",[t.minValue,t.maxValue]),this._gl.activeTexture(33985),this._gl.bindTexture(3553,t.cbte),this._pulseProgram.uniform1i("cbte",1),this._pulseProgram.uniform1f("ail",t.ail),this._pulseProgram.uniform2fv("prs",t.prs),this._pulseProgram.uniform1f("tcy",t.tcy),this._pulseProgram.uniform1f("fte",t.time),this._vbLayout.enableVertexAttribArrays(this._gl,this._pulseProgram,!1),519!==this._gl.web3DDefaultState.depthFunc&&this._gl.depthFunc(519),this._gl.depthMask(!1),this._gl.enable(2884),this._gl.cullFace(1029),this._gl.enable(2929),this._gl.enable(3042),this._gl.blendFunc(770,771)},blend:function(t){0==t?this._gl.blendFunc(this._srcAlpha,this._dstAlpha):1==t&&this._gl.blendFunc(770,771)},release:function(){this._gl.activeTexture(33984),this._gl.depthMask(!0),519!==this._gl.web3DDefaultState.depthFunc&&this._gl.depthFunc(this._gl.web3DDefaultState.depthFunc),this._gl.blendFunc(770,771),this._gl.disable(3042),this._gl.cullFace(1029),this._gl.disable(2884),this._vbLayout.disableVertexAttribArrays(this._gl,this._program,!1),this._vbLayout.disableVertexAttribArrays(this._gl,this._pulseProgram,!1),this._gl.useProgram(null)}});return a});